diff --git a/core/lib/Drupal/Core/Hook/HookCollectorPass.php b/core/lib/Drupal/Core/Hook/HookCollectorPass.php
index 007f717c02cc65a4ad9168ba7cbb53632acd11c0..aa5e02eb40ddf4a0a45104c228148f85426bb1bd 100644
--- a/core/lib/Drupal/Core/Hook/HookCollectorPass.php
+++ b/core/lib/Drupal/Core/Hook/HookCollectorPass.php
@@ -295,7 +295,7 @@ protected function calculateImplementations(): array {
       }
       foreach ($moduleImplements as $module => $v) {
         if (is_string($hook) && str_starts_with($hook, 'preprocess_') && str_contains($hook, '__')) {
-          $this->preprocessForSuggestions[$module . '_' . $hook] = TRUE;
+          $this->preprocessForSuggestions[$module . '_' . $hook] = 'module';
         }
         foreach (array_keys($implementationsByHookOrig[$hook], $module, TRUE) as $identifier) {
           $implementationsByHook[$hook][$identifier] = $module;
diff --git a/core/lib/Drupal/Core/Hook/ThemeHookCollectorPass.php b/core/lib/Drupal/Core/Hook/ThemeHookCollectorPass.php
index 88fe7b692d769e76b594e386e7d9842851e85335..43f40e626652868ce7e0a4f8c93d4c3f3d2e9b3b 100644
--- a/core/lib/Drupal/Core/Hook/ThemeHookCollectorPass.php
+++ b/core/lib/Drupal/Core/Hook/ThemeHookCollectorPass.php
@@ -133,7 +133,7 @@ protected function calculateImplementations(): array {
     foreach ($implementationsByHookOrig as $hook => $hookImplementations) {
       if (is_string($hook) && str_starts_with($hook, 'preprocess_') && str_contains($hook, '__')) {
         foreach ($hookImplementations as $theme) {
-          $this->preprocessForSuggestions[$theme . '_' . $hook] = TRUE;
+          $this->preprocessForSuggestions[$theme . '_' . $hook] = 'theme';
         }
       }
     }
diff --git a/core/lib/Drupal/Core/Theme/Registry.php b/core/lib/Drupal/Core/Theme/Registry.php
index 0013cab86bd4abb59d656bfa52e2cfd502c0c69d..3c37d34ce1f11371f0fd186d20db911c0fcf3535 100644
--- a/core/lib/Drupal/Core/Theme/Registry.php
+++ b/core/lib/Drupal/Core/Theme/Registry.php
@@ -849,9 +849,12 @@ protected function postProcessExtension(array &$cache, ActiveTheme $theme) {
           if (isset($cache[$matches[2]])) {
             $level = substr_count($matches[1], '__');
             $suggestion_level[$level][$candidate] = $matches[1];
-            $module_preprocess_function = $prefix . '_preprocess_' . $matches[1];
-            if (isset($this->getPreprocessForSuggestions()[$module_preprocess_function])) {
-              $invokes[$candidate] = ['module' => $prefix, 'hook' => 'preprocess_' . $matches[1]];
+            $preprocess_function = $prefix . '_preprocess_' . $matches[1];
+            if (isset($this->getPreprocessForSuggestions()[$preprocess_function])) {
+              $invokes[$candidate] = [
+                $this->getPreprocessForSuggestions()[$preprocess_function] => $prefix,
+                'hook' => 'preprocess_' . $matches[1],
+              ];
             }
           }
         }
diff --git a/core/modules/system/tests/themes/HookCollector/oop_hook_theme/src/Hook/TestHookCollectionHooks.php b/core/modules/system/tests/themes/HookCollector/oop_hook_theme/src/Hook/TestHookCollectionHooks.php
index f0a6ec44c22c465b1190d5e39e77d736b81dff99..129535ebe463cabc61b83a2f917c6853765594f3 100644
--- a/core/modules/system/tests/themes/HookCollector/oop_hook_theme/src/Hook/TestHookCollectionHooks.php
+++ b/core/modules/system/tests/themes/HookCollector/oop_hook_theme/src/Hook/TestHookCollectionHooks.php
@@ -16,4 +16,9 @@ public function testHookAlter(array &$calls): void {
     $calls[] = __METHOD__;
   }
 
+  #[Hook('preprocess_mark__suggestion')]
+  public function preprocessMarkSuggestion(&$variables): void {
+    $variables[] = __METHOD__;
+  }
+
 }
diff --git a/core/tests/Drupal/KernelTests/Core/Theme/RegistryTest.php b/core/tests/Drupal/KernelTests/Core/Theme/RegistryTest.php
index 1ed89ed76dda4a95d15b36e0f89c0975c99b9ab0..757f4ebcd14d0f4c4856d5aa218bead9b63bbfb9 100644
--- a/core/tests/Drupal/KernelTests/Core/Theme/RegistryTest.php
+++ b/core/tests/Drupal/KernelTests/Core/Theme/RegistryTest.php
@@ -8,6 +8,7 @@
 use Drupal\Core\Path\CurrentPathStack;
 use Drupal\Core\Path\PathMatcherInterface;
 use Drupal\Core\Theme\Registry;
+use Drupal\Core\Theme\ThemeInitializationInterface;
 use Drupal\Core\Utility\ThemeRegistry;
 use Drupal\KernelTests\KernelTestBase;
 use PHPUnit\Framework\Attributes\DataProvider;
@@ -108,6 +109,31 @@ public function testMultipleSubThemes(): void {
     ], $preprocess_functions);
   }
 
+  /**
+   * Tests the theme registry candidate assignment.
+   */
+  public function testPreprocessCandidate(): void {
+    $theme_handler = \Drupal::service('theme_handler');
+    \Drupal::service('theme_installer')->install(['oop_hook_theme']);
+
+    $module_list = $this->container->get('extension.list.module');
+    assert($module_list instanceof ModuleExtensionList);
+
+    $registry_oop_theme = new Registry($this->root, \Drupal::cache(), \Drupal::lock(), \Drupal::moduleHandler(), $theme_handler, \Drupal::service('theme.initialization'), \Drupal::service('cache.bootstrap'), $module_list, \Drupal::service('kernel'), 'oop_hook_theme', \Drupal::service('keyvalue'));
+    $registry_oop_theme->setThemeManager(\Drupal::theme());
+
+    $expected_invoke_map = [
+      'theme' => 'oop_hook_theme',
+      'hook' => 'preprocess_mark__suggestion',
+    ];
+    $invoke_map = $registry_oop_theme->get()['preprocess invokes']['oop_hook_theme_preprocess_mark__suggestion'];
+
+    $this->assertSame(
+      $expected_invoke_map,
+      $invoke_map);
+
+  }
+
   /**
    * Tests the theme registry with suggestions.
    */
@@ -115,6 +141,8 @@ public function testSuggestionPreprocessFunctions(): void {
     $theme_handler = \Drupal::service('theme_handler');
     \Drupal::service('theme_installer')->install(['test_theme']);
 
+    \Drupal::theme()->setActiveTheme(\Drupal::service(ThemeInitializationInterface::class)->initTheme('test_theme'));
+
     $extension_list = $this->container->get('extension.list.module');
     assert($extension_list instanceof ModuleExtensionList);
     $registry_theme = new Registry($this->root, \Drupal::cache(), \Drupal::lock(), \Drupal::moduleHandler(), $theme_handler, \Drupal::service('theme.initialization'), \Drupal::service('cache.bootstrap'), $extension_list, \Drupal::service('kernel'), 'test_theme', \Drupal::service('keyvalue'));
@@ -131,8 +159,20 @@ public function testSuggestionPreprocessFunctions(): void {
       $expected_preprocess_functions[] = "test_theme_preprocess_$hook";
       $preprocess_functions = $registry_theme->get()[$hook]['preprocess functions'];
       $this->assertSame($expected_preprocess_functions, $preprocess_functions, "$hook has correct preprocess functions.");
+
+      // Ensure the invoke map has the expected structure.
+      $expected_invoke_map = [
+        'theme' => 'test_theme',
+        'hook' => "preprocess_$hook",
+      ];
+      $this->assertEquals($expected_invoke_map, $registry_theme->get()['preprocess invokes']["test_theme_preprocess_$hook"], "$hook has correct invokes.");
     } while ($suggestion = array_shift($suggestions));
 
+    // Ensure the theme preprocess for the suggestion runs and sets the bar
+    // variable.
+    $output = \Drupal::theme()->render('theme_test_preprocess_suggestions__kitten__flamingo', []);
+    $this->assertStringContainsString('Flamingo', (string) $output);
+
     $expected_preprocess_functions = [
       'theme_test_preprocess_theme_test_preprocess_suggestions',
       'test_theme_preprocess_theme_test_preprocess_suggestions',
