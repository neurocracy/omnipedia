From 18e0a0d86d5d856f451aa5d9094f03a7b8aeaf4c Mon Sep 17 00:00:00 2001
From: Andreas Hennings <andreas@dqxtech.net>
Date: Sun, 28 May 2023 15:06:49 +0200
Subject: [PATCH 1/3] Issue #3363080: Fix return type.

---
 src/HuxModuleHandler.php | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/src/HuxModuleHandler.php b/src/HuxModuleHandler.php
index 2c6955b..2e93f69 100644
--- a/src/HuxModuleHandler.php
+++ b/src/HuxModuleHandler.php
@@ -267,8 +267,8 @@ final class HuxModuleHandler implements ModuleHandlerInterface {
    * @param string $alter
    *   An alter.
    *
-   * @return \Generator<array{callable, string}>
-   *   A generator with hook callbacks and other metadata.
+   * @return \Generator<callable>
+   *   A generator with hook callbacks.
    */
   private function generateAlterInvokers(string $alter) {
     if (isset($this->alters[$alter])) {
-- 
GitLab


From b390baf080230a97ad6086a5a63c38a70135ce04 Mon Sep 17 00:00:00 2001
From: Andreas Hennings <andreas@dqxtech.net>
Date: Sat, 27 May 2023 02:22:07 +0200
Subject: [PATCH 2/3] Issue #3363080: Avoid unnecessary internal generators in
 HuxModuleHandler.

---
 src/HuxModuleHandler.php | 24 ++++++++++--------------
 1 file changed, 10 insertions(+), 14 deletions(-)

diff --git a/src/HuxModuleHandler.php b/src/HuxModuleHandler.php
index 2e93f69..61b894a 100644
--- a/src/HuxModuleHandler.php
+++ b/src/HuxModuleHandler.php
@@ -193,13 +193,12 @@ final class HuxModuleHandler implements ModuleHandlerInterface {
    * @param string $hook
    *   A hook.
    *
-   * @return \Generator<array{callable, string}>
-   *   A generator with hook callbacks and other metadata.
+   * @return list<array{callable, string}>
+   *   A list where each item has a hook callback and a module name.
    */
-  private function generateInvokers(string $hook) {
+  private function generateInvokers(string $hook): array {
     if (isset($this->hooks[$hook])) {
-      yield from $this->hooks[$hook];
-      return;
+      return $this->hooks[$hook];
     }
 
     $hooks = [];
@@ -224,9 +223,7 @@ final class HuxModuleHandler implements ModuleHandlerInterface {
     });
 
     // Wait for all the [sorted] callables before caching.
-    $this->hooks[$hook] = $hooks;
-
-    yield from $this->hooks[$hook];
+    return $this->hooks[$hook] = $hooks;
   }
 
   /**
@@ -267,13 +264,12 @@ final class HuxModuleHandler implements ModuleHandlerInterface {
    * @param string $alter
    *   An alter.
    *
-   * @return \Generator<callable>
-   *   A generator with hook callbacks.
+   * @return list<callable>
+   *   A list of hook implementation callbacks.
    */
-  private function generateAlterInvokers(string $alter) {
+  private function generateAlterInvokers(string $alter): array {
     if (isset($this->alters[$alter])) {
-      yield from $this->alters[$alter];
-      return;
+      return $this->alters[$alter];
     }
 
     $this->alters[$alter] = [];
@@ -282,7 +278,7 @@ final class HuxModuleHandler implements ModuleHandlerInterface {
       $this->alters[$alter][] = \Closure::fromCallable([$service, $methodName]);
     }
 
-    yield from $this->alters[$alter];
+    return $this->alters[$alter];
   }
 
   /**
-- 
GitLab


From 9ffe18d0a91457b224189b82ce0737b9cfa603a6 Mon Sep 17 00:00:00 2001
From: Andreas Hennings <andreas@dqxtech.net>
Date: Sun, 28 May 2023 02:02:44 +0200
Subject: [PATCH 3/3] Issue #3363080: Avoid unnecessary public generators in
 HuxDiscovery.

---
 src/HuxDiscovery.php | 30 +++++++++++++++---------------
 1 file changed, 15 insertions(+), 15 deletions(-)

diff --git a/src/HuxDiscovery.php b/src/HuxDiscovery.php
index 6d63147..4310507 100644
--- a/src/HuxDiscovery.php
+++ b/src/HuxDiscovery.php
@@ -127,12 +127,12 @@ final class HuxDiscovery {
    * @param string $hook
    *   A hook.
    *
-   * @return \Generator<array{string, string, string, int}>
-   *   A generator yielding an array of service ID, module name, method name,
-   *   and priority.
+   * @return list<array{string, string, string, int}>
+   *   A list where each item is an array of service ID, module name, method
+   *   name, and priority.
    */
-  public function getHooks(string $hook) {
-    yield from $this->discovery[Hook::class][$hook] ?? [];
+  public function getHooks(string $hook): array {
+    return $this->discovery[Hook::class][$hook] ?? [];
   }
 
   /**
@@ -141,13 +141,13 @@ final class HuxDiscovery {
    * @param string $hook
    *   A hook.
    *
-   * @return \Generator<array{string, string, string, int[]}>
-   *   A generator yielding an array of service ID, module name, method name,
-   *   and flag for whether the original implementation should be passed as a
-   *   callable as first parameter.
+   * @return list<array{string, string, string, int[]}>
+   *   A list where each item is an array with service id, module name, method
+   *   name, and a flag for whether the original implementation should be passed
+   *   as a callable as first parameter.
    */
-  public function getHookReplacements(string $hook) {
-    yield from $this->discovery[ReplaceOriginalHook::class][$hook] ?? [];
+  public function getHookReplacements(string $hook): array {
+    return $this->discovery[ReplaceOriginalHook::class][$hook] ?? [];
   }
 
   /**
@@ -156,11 +156,11 @@ final class HuxDiscovery {
    * @param string $alter
    *   An alter.
    *
-   * @return \Generator<array{string, string, string}>
-   *   A generator yielding an array of service ID,  method name.
+   * @return list<array{string, string, string}>
+   *   A list where each item isan array of service ID and method name.
    */
-  public function getAlters(string $alter) {
-    yield from $this->discovery[Alter::class][$alter] ?? [];
+  public function getAlters(string $alter): array {
+    return $this->discovery[Alter::class][$alter] ?? [];
   }
 
   /**
-- 
GitLab

